<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" type="text/css" />
    <title>Assessment Javascript</title>
  </head>
  <body>
    <header>
      <div class="topnav">
        <a class="active" href="index.html">Home</a>
        <a href="lojas.html">Lojas</a>
        <a href="livros.html">Livros</a>
      </div>
    </header>

    <div>
      <h2>Zebra Striped Table</h2>
      <p>
        For zebra-striped tables, use the nth-child() selector and add a
        background-color to all even (or odd) table rows:
      </p>

      <table id="tabelaDados">
        <tr>
          <th>Livro</th>
          <th>Autor</th>
          <th>Preço</th>
          <th>Loja</th>
        </tr>
      </table>
      <tbody></tbody>
    </div>

    <script type="text/javascript">
      //Cria a tabela
      function novaLinha(tbody, array_valores) {
        let novaLinha = tbody.insertRow();

        array_valores.forEach(function (v, i) {
          let novaCelula = novaLinha.insertCell(i);

          let novoTexto = document.createTextNode(v);
          if (typeof v == "object") {
            novoTexto = v;
          }

          novaCelula.appendChild(novoTexto);
        });
      }

      function getDados() {
        if (localStorage.getItem("dados") == null) {
          localStorage.setItem(
            "dados",
            JSON.stringify([
              {
                nomeLivro: "Livro 1",
                autor: "Lucas Samel",
                preco: 100,
                loja: "Amazon",
              },
              {
                nomeLivro: "Livro 2",
                autor: "João Silva",
                preco: 80,
                loja: "Saraiva",
              }
            ])
          );
        }

        return JSON.parse(localStorage.getItem("dados"));
      }

      //Insere os dados na tabela / traduz
      function setDados(x) {
        localStorage.setItem("dados", JSON.stringify(x));
      }

      //Atuliza a tabela
      function atualizaTabela() {
        let tbody = document
          .getElementById("tabelaDados")
          .getElementsByTagName("tbody")[0];

        tbody.innerHTML = "";

        getDados().forEach(function (livro, i) {
          let linkRemover = document.createElement("span");
          linkRemover.innerHTML = "remover";
          linkRemover.addEventListener("click", function (e) {
            if (confirm(`Deseja remover ${livro.nomeLivro} ?`)) {
              let dadosModificados = getDados();
              dadosModificados.splice(i, 1);
              setDados(dadosModificados);
            }

            atualizaTabela();
          });

          let estacao = "";

          if (patinete.estacao != undefined) {
            estacao = patinete.estacao.cidade;
          }

          novaLinha(tbody, [
            patinete.cidade,
            patinete.velocidade,
            patinete.marca,
            estacao,
            linkRemover,
          ]);
        });
      }

      //Cadastra nova informacao na tabela
      document
        .getElementById("buttonCadastrar")
        .addEventListener("click", function () {
          let formulario = document.getElementById("meuForm");

          let dadosForm = new FormData(formulario);

          let novoDado = Object.fromEntries(dadosForm);

          let dados = getDados();

          dados.push(novoDado);

          setDados(dados);
        });

      //Escuta os eventos
      document.addEventListener("DOMContentLoaded", function (event) {
        atualizaTabela();
      });
    </script>
  </body>
</html>
